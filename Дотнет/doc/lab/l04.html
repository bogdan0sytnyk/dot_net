<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Transitional//EN">
<HTML>
<HEAD>
   <meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
   <meta name="Author" content="Alexander S. Derevjanko">
   <meta name="Generator" content="Far Editor">
   <meta name="Description" content="Data structures">
   <meta name="Owner" content="derev@insart.kharkov.ua">
   <meta name="Keywords" content="программирование, C">

<title>Основы программирования. Лабораторные работы </title>
<!--                                                                   -->
<!-- (C) Owner: Alexander S. Derevjanko -->
<!-- (C) ХГПУ. Каф.Информатики и интеллектуальной собственности, 2000. -->

</head>

<body background=../../iip_1.jpg>
<p>
<table cellpadding=10>
<tr><td><a href=../../index.html>Каталог</a></td><td><a href=../index.html>Индекс раздела</a></td><td></tr>
</table>
<table cellpadding=10>
<tr><td><a href=l03.html>Назад</a></td><td><a href=index.html>Оглавление</a></td><td><a href=l05.html>Вперед</a></td></tr>
</table>
</p>
<hr>

<h2 align=center>Лабораторная работа ╧4<br>
Битовые операции</h2>

<h3 align=center>1. Цель работи</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Целью лабораторной работы является получение практических навыков в работе с побитовими логическими операциями и операциями сдвига языка C.

<h3 align=center>2. Темы для предварительной проработки </h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Побитовые логические операции и операции сдвига.

<h3 align=center>3. Задание для выполнения</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Составить две программы, первая из которых вводит составные части структуры данных, приведенной в Вашем варианте индивидуального задания, и формирует из них заданную упакованную структуру. Вторая программа вводит упакованную структуру как 16-ричное число и выводит значения отдельных ее составных частей.

<h3 align=center>4. Варианты индивидуальных заданий</h3>
<p><table align=center>
<tr><td>&nbsp;<a href=v04_01.html>1</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_02.html>2</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_03.html>3</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_04.html>4</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_05.html>5</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_06.html>6</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_07.html>7</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_08.html>8</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>&nbsp;<a href=v04_09.html>9</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_10.html>10</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td><a href=v04_11.html>11</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_12.html>12</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_13.html>13</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_14.html>14</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_15.html>15</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_16.html>16</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_17.html>17</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_18.html>18</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_19.html>19</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_20.html>20</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td><a href=v04_21.html>21</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_22.html>22</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_23.html>23</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_24.html>24</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_25.html>25</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_26.html>26</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_27.html>27</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_28.html>28</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_29.html>29</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href=v04_30.html>30</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
</table>
</p>
<p></p>

<h3 align=center>5. Пример решения задачи (вариант 30)</h3>

<h4 align=center>5.1. Программа упаковки</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1. Разработка алгоритма решения.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Алгоритм программы линейный и состоит из таких шагов.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1.1. Ввод значений составных частей слова состояния устройства. Для каждой составной части нужно вывести приглашение на ввод и ввести данные.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1.2. Занесение в слово состояния устройства кода состояния. У переменной, которая хранит значение кода состояния, нужно выделить 5 младших разрядов - это можно сделать, выполнив операцию "побитовое логическое И" между значением переменной и двоичной константой 00011111 (16-ричной константой 1F). Потом полученное значения следует сдвинуть на 11 разрядов влево.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1.3. Занесение в слово состояния устройства признака ошибки. В переменной - признаке ошибки выделить один младший разряд - операция "побитовое логическое И" с константой 1. Полученное значение сдвинуть на 9 разрядов влево. Чтобы добавит полученный код к тому коду, который уже получен на предыдущем шаге, нужно выполнить операцию "побитовое логическое ИЛИ" между предыдущим значением слова состояния устройства и полученным кодом.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1.4. Занесение в слово состояния устройства признака занятости. В переменной  - признаке занятости выделить один младший разряд. Полученное значение сдвинуть на 8 разрядов влево и добавить к тому коду, который получен на предыдущем шаге (так же как в пп.5.1.1.3.).
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.1.5. Занесение в слово состояния устройства количества байт. В переменной - количестве байт выделить 8 младших разрядов - "побитовое логическое И" с константой FF16. Полученное значение добавить (см. пп.5.1.1.3.) к тому коду, который уже есть.
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Отметим, что если значения составных частей кода, введенные оператором, не выходят за диапазон допустимых для них значений, то операция выделения младших байтов излишня. Но мы предусматриваем ее на случай ошибок оператора.

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.2. Определение переменных программы
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Для работы программы нам будут нужны переменные, в которых будут храниться составные части кода. Для сохранения всех составных частей будет достаточно по 1 байту, следовательно, тип этих переменных может быть <b><I>char</I></b> или <b><I>unsigned char</I></b>. Диапазоны возможных значений этих переменных:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><I>c</I></b> - код состояния - 0 ...31<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><I>f</I></b> - признак ошибки - 0, 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><I>b</I></b> - признак занятости - 0, 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><I>n</I></b> - количество байт - 0 ... 255
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Отметим, что в переменных <b><I>c</I></b>, <b><I>f</I></b>, <b><I>b</I></b> старший разряд байта не используется, так что не имеет значения, будут они типа <b><I>char</I></b> или <b><I>unsigned char</I></b>. В переменной <b><I>n</I></b> используется старший разряд, следовательно, она обязательно должна быть типа <b><I>unsigned char</I></b>.
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Нужна также переменная для сохранения результирующего кода слова состояния устройства. Это 2-байтная  переменная, у которой старший разряд используется как кодовый, а не как знаковый. Так что, эта переменная должна быть типа <b><I>unsigned int</I></b>.

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.3. Разработка текста программы
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Текст программы  начинается с включения в программу файла:
<pre>
    #include &lt;stdio.h&gt;
</pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;В этом файле содержатся описания стандартных функций ввода-вывода, которые непременно будут использоваться в программе.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Далее идет заголовок функции <b><I>main()</I></b>:
<pre>
    int main(void) {
</pre>
и объявления переменных - точно по пп 5.1.2:
<pre>
    char c; 
    char f; 
    char b;
    unsigned char n; 
    unsigned int UnitStateWord; 
</pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ввод кода состояния складывается из вывода на экран приглашения:
<pre>
    printf("Введите код состояния (0 - 31) >");
</pre>
и собственно ввода значения в переменную <b><I>c</i></b>:
<pre>
    scanf("%d",&c);
</pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Такие же пары операторов повторяются для ввода значений <b><I>f</I></b>, <b><I>b</I></b>, <b><I>n</I></b>. Все значения вводятся как десятичные числа, используется тип <b><I>%d</I></b> в спецификациях формата.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Далее идет формирование упакованного кода, которое точно повторяет шаги алгоритма описанного в пп. 5.1.1:
<ul>
<li> по пп.5.1.1.2:
<pre>
UnitStateWord=((unsigned char)c&0x1F)&lt;&lt;11;
</pre>
Преобразование типа переменной <samp>c</samp> в <i><b>unsigned char</b></i> необходимо, потому что иначе сдвиг 8-разрядного кода на 11 разрядов приведет к потере нужных нам кодов.
<p></p>
<li> по пп.5.1.1.3:
<pre>
UnitStateWord|=((unsigned char)f&1)&lt;&lt;9;
</pre>
<li> по пп.5.1.1.4:
<pre>
UnitStateWord|=((unsigned char)b&1)&lt;&lt;8;
</pre>
<li> пл пп.5.1.1.5:
<pre>
UnitStateWord|=n&0xFF;
</pre>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Вывод результата выполняется оператором:
<pre>
    printf("\nСлово состояния устройства = %04x\n",UnitStateWord);
</pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Результат выводится как 16-ричное число из 4 цифр (что соответствует 2 байтам), обязательно выводятся ведущие нули.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Полный текст программы приведен ниже.
<pre>
/******************************************************/
/*           Лабораторная работа ╧4 (часть 1)         */
/*                   Упаковка кода                    */
/*            Пример выполнения. Вариант ╧30.         */
/******************************************************/
#include &lt;stdio.h&gt;
int main(void) {
 char c; /* код состояния */
 char f; /* признак ошибки */
 char b; /* признак занятости */
 unsigned char n; /* количество байт */
 unsigned int UnitStateWord; /* слово состояния */
  /* ввод составных частей */
  printf("Введите код состояния (0 - 31) &gt;");
  scanf("%d",&c);
  printf("Введите признак ошибки (0 / 1) &gt;");
  scanf("%d",&f);
  printf("Введите признак занятости (0 / 1) &gt;");
  scanf("%d",&b);
  printf("Введите количество переданных байт (0 - 255) &gt;");
  scanf("%d",&n);
  /* формирование упакованного кода */
  UnitStateWord=((unsigned int)c&0x1F)&lt;&lt;11;
  UnitStateWord|=((unsigned int)f&1)&lt;&lt;9;
  UnitStateWord|=((unsigned int)b&1)&lt;&lt;8;
  UnitStateWord|=n&0xFF;
  /* вывод результата */
  printf("\nСлово состояния устройства = %04x\n",
     UnitStateWord);
  return 0;
}
</pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.4. Отладка программы
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Отладку программы можно вести в пошаговом режиме с отслеживанием значений переменных - составных частей при их вводе и  кода-результата на шагах его формирования. Для последнего может возникнуть неудобство, т.к. в режиме отладки значение переменной <b><I>UnitStateWord</I></b> будет представляться как десятичное число, а нам удобнее видеть его как 16-ричное или как 2-ичное. Поэтому для такого отслеживания удобнее будет вставить в соответствующие места текста программы вызовы функции <b><I>printf</I></b>, которые будут выводить промежуточные значения кода в 16-ричном формате.

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.1.5. Результаты работы программы

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;При работе программы на экран были выведены такие результаты:
<pre>
Введите код состояния (0 - 31) &gt;27
Введите признак ошибки (0 / 1) &gt;1
Введите признак занятости (0 / 1) &gt;1
Введите количество переданных байт (0 - 255) &gt;74

Слово состояния устройства = db4a
</pre>

<h4 align=center>5.2. Программа распаковки</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1. Разработка алгоритма решения.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Алгоритм программы линейный и состоит из таких шагов. 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1.1. Ввод значения слова состояния устройства. 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1.2. Выделение из слова состояния устройства кода состояния. Код слова состояния устройства нужно сдвинуть на 11 разрядов вправо и выделить 5 младших разрядов - "побитовое логическое И" с константой 1F16. Слово состояния устройства остается неизменным, а полученное значение записывается в переменную для кода состояния.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1.3. Выделение из слова состояния устройства признака ошибки. Код слова состояния устройства сдвинуть на 9 разрядов вправо и выделить 1 младший разряд - "побитовое логическое И" с константой 1. Слово состояния устройства остается неизменным, а полученное значение записывается в переменную для признака ошибки.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1.4. Выделение из слова состояния устройства признака занятости. Код слова состояния устройства сдвинуть на 9 разрядов вправо и выделить 1 младший разряд. Слово состояния устройства остается неизменным, а полученное значение записывается в переменную для признака занятости.
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1.5. Выделение из слова состояния устройства количества байт. В коде слова состояния устройства нужно выделить 8 младших разрядов - "побитовое логическое И" с константой FF16. Полученное значение записывается в переменную для количества байт.

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.2. Определение переменных программы
Для работы программы нам будут нужны такие же переменные, что и в пп. 5.1.2.

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.3. Разработка текста программы
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Начало программы - заголовок и определение переменных - по пп. 5.1.3.
Далее идет формирования упакованного кода, которое точно повторяет шаги алгоритма, описанного в пп. 5.2.1:
<ul>
<li> по пп.5.1.2.2:
<pre>
c=(UnitStateWord&gt;&gt;11)&0x1F;
</pre>
<li> по пп.5.1.2.3:
<pre>
f=(UnitStateWord&gt;&gt;9)&1;
</pre>
<li> по пп.5.1.2.4:
<pre>
b=(UnitStateWord&gt;&gt;8)&1;
</pre>
<li> по пп.5.1.2.5:
<pre>
n=UnitStateWord&0xFF;
</pre>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Вывод первого результата - кода состояния выполняется оператором:
<pre>
    printf("Код состояния                = %d\n",c);
</pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Подобными операторами выполняется и вывод остальных результатов
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Полный текст программы приведен ниже.
<pre>
/******************************************************/
/*           Лабораторная работа ╧4 (часть 2)         */
/*                 Распаковка кода                    */
/*            Пример выполнения. Вариант ╧30.         */
/******************************************************/
#include &lt;stdio.h&gt;
int main(void) {
 char c; /* код состояния */
 char f; /* признак ошибки */
 char b; /* признак занятости */
 unsigned char n; /* количество байт */
 unsigned int UnitStateWord; /* слово состояния */
  /* ввод слова состояния устройства */
  printf("Введите cлово состояния устройства \n");
  printf("(16-ричное число от 0 до 0xFFFF) &gt;");
  scanf("%x",&UnitStateWord);
  /* Выделение составных частей */
  c=(UnitStateWord&gt;&gt;11)&0x1F;
  f=(UnitStateWord&gt;&gt;9)&1;
  b=(UnitStateWord&gt;&gt;8)&1;
  n=UnitStateWord&0xFF;
  /* вывод результатов */
  putchar('\n');
  printf("Код состояния                  = %d\n",c);
  printf("Признак ошибки             = %d\n",f);
  printf("Признак занятости          = %d\n",b);
  printf("Количество переданных байт = %d\n",n);
  return 0;
}
</pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.4. Отладка программы
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Отладка программы ведется по методике, описанной в пп.5.1.4.

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.5. Результаты работы программы

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;При работе программы на экран были выведены такие результаты:

<pre>
Введите cлово состояния устройства 
(16-ричное число от 0 до 0xFFFF) &gt;cb42

Код состояния                  = 25
Признак ошибки             = 1
Признак занятости          = 1
Количество переданных байт = 66
</pre>


<h4 align=center>5.3. Выводы</h4>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;При выполнении лабораторной работы изучены побитовые операции языка C.

<p><hr>
<table cellpadding=10>
<tr><td><a href=../../index.html>Каталог</a></td><td><a href=../index.html>Индекс раздела</a></td><td></tr>
</table>
<table cellpadding=10>
<tr><td><a href=l03.html>Назад</a></td><td><a href=index.html>Оглавление</a></td><td><a href=l05.html>Вперед</a></td></tr>
</table>
</p>
<hr>
</body>
</html>

